import json
import datetime
from locust import HttpUser, task, between, run_single_user
from utils.user import random_login
from random import random, randrange

class ReviewUser(HttpUser):
    host = "http://localhost:5183"
    wait_time = between(1, 5)

    @task
    def hello_world(self):
        headers = {'Authorization':self.login}
        print(headers)

        response = self.client.get(
            "http://localhost:5181/getItems?page=1&size=2", 
            headers=headers)

        #reviews = self.client.get(
        #    "http://localhost:5183/getReviews", 
        #    headers=headers)
        
        #print(response.json())
        rjson = response.json()
        rdata = rjson["data"]
        #rid = rdata[0]['id']
        rlen = len(rdata)
        rid = randrange(rlen)


        #2023-04-06T04:54:18.592Z
        review = {
            "id": 0,
            "itemId": 1,
            "customerId": 1,
            "timeCreated": datetime.date.today().strftime("%Y-%m-%d"),
            "timeUpdated": datetime.date.today().strftime("%Y-%m-%d"),
            "title": "lorem ipsum",
            "reviewText": "dolor sit amet"
        }

        r = self.client.post(
            "http://localhost:5183/postReview", 
            headers=headers, 
            json=review
        )

        print(r)

    def on_start(self):
        self.login = random_login()
        return super().on_start()
    
# if launched directly, e.g. "python3 debugging.py", not "locust -f debugging.py"
if __name__ == "__main__":
    run_single_user(ReviewUser)