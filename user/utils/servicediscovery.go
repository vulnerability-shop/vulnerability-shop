package utils

import (
	"errors"
	"io/ioutil"
	"net/http"
)

func Register() error {
	url := "http://service-discovery:4000/register?name=user&address=http://user:80"
	client := &http.Client{}
	req, _ := http.NewRequest("GET", url, nil)
	req.Header.Set("authtoken", "admin123")
	_, err := client.Do(req)

	//_, err := http.Get("http://service-discovery:4000/register?name=user&address=http://user:80")
	if err != nil {
		return errors.New("Failed registering service")
	}
	return nil
}

func GetService(serviceName string) (string, error) {
	url := "http://service-discovery:4000/find?name=" + serviceName
	client := &http.Client{}
	req, _ := http.NewRequest("GET", url, nil)
	req.Header.Set("authtoken", "admin123")
	res, err := client.Do(req)
	if err != nil {
		return "", errors.New("Failed to get service address")
	}
	body, err2 := ioutil.ReadAll(res.Body)
	if err2 != nil {
		return "", errors.New("Error on read response")
	}
	res.Body.Close()
	return string(body), nil
}
