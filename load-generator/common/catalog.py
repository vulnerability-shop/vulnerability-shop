import random
import json
from locust import FastHttpUser
from config import config


def get_items_page(http: FastHttpUser, page: int = -1, size: int = 10):
    if page == -1:
        page = random.randint(1, 1000 / size)

    url = f'{config["catalog"]["host"]}/getItems?page={page}&size={size}'
    with http.rest(method="GET", url=url) as response:
        if response.js is not None:
            items = json.loads(response.text)['data']
            return items


def get_all_items(http: FastHttpUser):
    url = f'{config["catalog"]["host"]}/getItems'
    with http.rest(method="GET", url=url) as response:
        if response.js is not None:
            items = json.loads(response.text)
            return items


def get_item(http: FastHttpUser, item_id):
    url = f'{config["catalog"]["host"]}/getItem/{item_id}'
    with http.rest(method="GET", url=url) as response:
        if response.js is not None:
            item = json.loads(response.text)
            return item


def get_random_item(http: FastHttpUser):
    # Fetch random page
    items = get_items_page(http)

    # Choose random item
    item_id = items[random.randint(1, len(items) - 1)]['id']

    # Fetch item info to simulate going to the item details page
    item = get_item(http, item_id)
    return item
