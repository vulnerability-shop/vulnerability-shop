import random
from common.user import random_login
from common.catalog import get_random_item
from common.review import add_review, add_image_to_review
from locust import FastHttpUser, task, run_single_user
from config import config


class ReviewScenario(FastHttpUser):

    host = config["review"]["host"]

    @task
    def main(self):
        # Login
        auth = random_login(self)

        # Fetch item info to simulate going to the item details page
        item = get_random_item(self)

        # Write review
        # TODO create a list of reviews to add variety
        review_id = add_review(self, auth, item['id'], "Very good item")

        # Roll for chance of image
        roll = random.randint(1, 10)
        if roll < 3:
            # Fetch image from list
            # TODO fetch from a list to add variety
            image_path = "../../resources/images/red_square.png"
            # Upload image to review
            add_image_to_review(self, auth, review_id, image_path)


if __name__ == '__main__':
    run_single_user(ReviewScenario)
