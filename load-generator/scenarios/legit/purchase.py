from common.user import random_login
from common.cart import add_to_cart_random, get_cart_items
from common.purchase import add_purchase
from locust import FastHttpUser, task, run_single_user
from config import config
import logging

class PurchaseScenario(FastHttpUser):

    host = config["purchase"]["host"]

    @task
    def main(self):
        # Login
        auth = random_login(self)

        # Add items to cart, if for some reason none were added, stop here
        nb_items = add_to_cart_random(self, auth)
        if len(nb_items) == 0:
            logging.info('No items were added to the cart, aborting purchase')
            return

        # View cart, for more natural traffic
        get_cart_items(self, auth)

        # Complete purchase
        add_purchase(self, auth)


if __name__ == '__main__':
    run_single_user(PurchaseScenario)
