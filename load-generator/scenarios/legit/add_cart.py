import random
from common.user import random_login
from common.cart import add_to_cart_random, clear_cart, get_cart_items, update_cart_item, remove_cart_item
from locust import FastHttpUser, task, run_single_user
from config import config

class AddCartScenario(FastHttpUser):

    host = config["catalog"]["host"]

    @task
    def main(self):
        # Login
        auth = random_login(self)

        # Add items to cart
        add_to_cart_random(self, auth)

        # For each item roll for an additional action
        items = get_cart_items(self, auth)
        for item in items:
            match random.randint(0, 10):
                case 1:
                    update_cart_item(self, auth, item['id'], item['itemQuantity'] + 1)
                    continue
                case 2:
                    update_cart_item(self, auth, item['id'], item['itemQuantity'] - 1)
                    continue
                case 3:
                    remove_cart_item(self, auth, item['id'])
                    continue
                case _:
                    continue

        # Random chance for user to clear his cart
        if random.randint(0, 2) == 1:
            clear_cart(self, auth)


if __name__ == '__main__':
    run_single_user(AddCartScenario)


