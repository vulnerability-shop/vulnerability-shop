import nmap
from locust import FastHttpUser, task, run_single_user
from config import config

class NmapScan(FastHttpUser):
    host = config['user']['host']
    nmapHost = '127.0.0.1'
    ports = '5173-5432'

    @task
    def scan(self):
        nm = nmap.PortScanner()
        nm.scan(hosts=self.nmapHost, ports=self.ports, arguments='-A -sV')
        for host in nm.all_hosts():
            for proto in nm[host].all_protocols():
                for port in nm[host][proto].keys():
                    print(
                        'port : %s\tstate : %s\tname : %s\tproduct : %s' % (
                            port,
                            nm[host][proto][port]['state'],
                            nm[host][proto][port]['name'],
                            nm[host][proto][port]['product'],
                        )
                    )
        pass


if __name__ == "__main__":
    run_single_user(NmapScan)
