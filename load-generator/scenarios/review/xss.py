import random
from common.user import random_login
from common.catalog import get_random_item
from common.review import add_review
from locust import FastHttpUser, task, run_single_user
from config import config


class CrossSiteScriptingScenario(FastHttpUser):

    host = config["review"]["host"]

    # Fetch XSS script
    xss_text = ""
    with open('../../resources/xss_alert_hacked.js', 'r') as f:
        xss_text = xss_text.join(f.readlines())
    review_text = f'<script>\n{xss_text}\n</script> Very good item'

    @task
    def main(self):
        # Login
        auth = random_login(self)

        # Fetch random item
        item = get_random_item(self)

        # Write review
        add_review(self, auth, item['id'], self.review_text)


if __name__ == '__main__':
    run_single_user(CrossSiteScriptingScenario)
