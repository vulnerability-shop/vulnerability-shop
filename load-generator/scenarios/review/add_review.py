import json
import datetime
from locust import HttpUser, task, between, run_single_user, FastHttpUser
from random import random, randrange
from config import config

class AddReviewScenario(FastHttpUser):
    host = config["review"]["host"]
    wait_time = between(1, 5)

    @task
    def main(self):
        # login here

        a = "{0}/postReview".format(self.host)

        # post review
        self.client.post(
            "http://localhost:5183/postReview", 
            headers={'Host': 'localhost:5183', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0', 'Accept': 'text/plain', 'Accept-Language': 'en-US,en;q=0.5', 'Accept-Encoding': 'gzip, deflate, br', 'Referer': 'http://localhost:5173/', 'Content-Type': 'application/json', 'Content-Length': '184', 'Origin': 'http://localhost:5183', 'DNT': '1', 'Connection': 'keep-alive', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin'}, 
            data="{\"id\": 0,\"itemId\": 1,\"customerId\": 1,\"timeCreated\": \"2023-04-10T18:22:03.017Z\",\"timeUpdated\": \"2023-04-10T18:22:03.017Z\",\"title\": \"string\",\"reviewText\": \"string\"}")

        # get created review
        self.client.get(
            "http://localhost:5183/getReviewsForItem/1", 
            headers={'Host': 'localhost:5183', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0', 'Accept': 'text/plain', 'Accept-Language': 'en-US,en;q=0.5', 'Accept-Encoding': 'gzip, deflate, br', 'Referer': 'http://localhost:5173/', 'DNT': '1', 'Connection': 'keep-alive', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin'}, 
            data="")

        attachement = open("D:\\PFE\\cat.jpg", "rb")
        #self.client.post("http://localhost:5183/postPicture/1", 
        # headers={'Host': 'localhost:5183', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0', 'Accept': '*/*', 'Accept-Language': 'en-US,en;q=0.5', 'Accept-Encoding': 'gzip, deflate, br', 'Referer': 'http://localhost:5173/', 'Content-Type': 'multipart/form-data; boundary=---------------------------41213037495978851713685263220', 'Content-Length': '225', 'Origin': 'http://localhost:5183', 'DNT': '1', 'Connection': 'keep-alive', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin'})
        self.client.post(
            "http://localhost:5183/postPicture/1", 
            files={
                'picture':attachement
            })

        self.client.get(
            "http://localhost:5183/getPicture/1", 
            headers={'Host': 'localhost:5183', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0', 'Accept': '*/*', 'Accept-Language': 'en-US,en;q=0.5', 'Accept-Encoding': 'gzip, deflate, br', 'Referer': 'http://localhost:5173/', 'DNT': '1', 'Connection': 'keep-alive', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin'}, 
            data="")

    def on_start(self):
        #self.login = random_login()
        return super().on_start()
    
# if launched directly, e.g. "python3 debugging.py", not "locust -f debugging.py"
if __name__ == "__main__":
    run_single_user(AddReviewScenario)