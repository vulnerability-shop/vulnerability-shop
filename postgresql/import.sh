#!/bin/bash

set -e

export PGPASSWORD=admin

echo "Starting import script..."

# Wait for the database to be ready
until psql -U admin -d ecommerce -c '\q' &>/dev/null; do
  echo "Waiting for the database to be ready..."
  sleep 1
done

# Import CSV files into ecommerce database
echo "BEGIN - importing csv files"
psql -U admin -d ecommerce -c "\COPY customer (email,username,password,firstName,lastName,address,phoneNumber,user_role) FROM '/tmp/import_data_Customer.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY item (name,description,image,price,stock) FROM '/tmp/import_data_Item.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY payment (customer_id,cardNumber,expMonth,expYear,CVV) FROM '/tmp/import_data_Payment.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY purchase (customer_id,payment_id,purchase_cost,purchase_date) FROM '/tmp/import_data_Purchase.csv' DELIMITER ',' CSV HEADER;"
echo "END - importing csv files"