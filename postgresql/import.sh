#!/bin/bash

set -e

export PGPASSWORD=admin

echo "Starting import script..."

# Wait for the database to be ready
until psql -U admin -d ecommerce -c '\q' &>/dev/null; do
  echo "Waiting for the database to be ready..."
  sleep 1
done

# Import CSV files into ecommerce database
echo "BEGIN - importing csv files"
psql -U admin -d ecommerce -c "\COPY customer FROM '/tmp/import_data_Customer.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY item FROM '/tmp/import_data_Item.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY payment FROM '/tmp/import_data_Payment.csv' DELIMITER ',' CSV HEADER;"
psql -U admin -d ecommerce -c "\COPY purchase FROM '/tmp/import_data_Purchase.csv' DELIMITER ',' CSV HEADER;"
echo "END - importing csv files"